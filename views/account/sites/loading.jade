doctype html
html
  head
    block head
      title #{title}
    meta(name='viewport', content='width=device-width, initial-scale=1.0')
    // link(rel='stylesheet', href='/layouts/core.min.css?#{cacheBreaker}')
    block neck

    link(rel='preload', href='/css/ui-darkness/jquery-ui.min.css', as='style', onload='this.onload=null;this.rel=\'stylesheet\'')
    link(rel='preload', href='/css/jquery.tooltips.css', as='style', onload='this.onload=null;this.rel=\'stylesheet\'')
    link(rel='preload', href='/css/main.css', as='style', onload='this.onload=null;this.rel=\'stylesheet\'')
    style(media='screen', type='text/css').
      
      #centerMessagePanel {
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            background: #000000;
            z-index: 1000;
          }
      
          #loadingMessage {
            text-align: center;
            position: absolute;
            width: 100%;
            height: 90%;
            top: 30%;
            left: 0;
            font-size: 16px;
          }
      
          .spinner {
            margin: 100px auto 0;
            width: 70px;
            text-align: center;
          }
      
          .spinner>div {
            width: 18px;
            height: 18px;
            background-color: #333;
      
            border-radius: 100%;
            display: inline-block;
            -webkit-animation: sk-bouncedelay 1.4s infinite ease-in-out both;
            animation: sk-bouncedelay 1.4s infinite ease-in-out both;
          }
      
          .spinner .bounce1 {
            -webkit-animation-delay: -0.32s;
            animation-delay: -0.32s;
          }
      
          .spinner .bounce2 {
            -webkit-animation-delay: -0.16s;
            animation-delay: -0.16s;
          }
      
          @-webkit-keyframes sk-bouncedelay {
            0%, 80%, 100% { -webkit-transform: scale(0) }
            40% { -webkit-transform: scale(1.0) }
          }
      
          @keyframes sk-bouncedelay {
             0%, 80%, 100% { 
               -webkit-transform: scale(0);
               transform: scale(0);
             } 40% { 
               -webkit-transform: scale(1.0);
               transform: scale(1.0);
          }
      }:

  body

    pre.
      #!{JSON.stringify(site, null, '\t')}

    #centerMessagePanel
      #loadingMessage
        p
          img(src='/images/launch.png')
        p#loadingMessageText Loading Nightscout
        .spinner
          .bounce1
          .bounce2
          .bounce3
    .container.loading#container

    script(src='/api/v1/status.js')
    script(src='/bundle/js/bundle.app.js')
    script(src='/socket.io/socket.io.js')
    script.
      $(document).ready(function ( ) {
        Nightscout.client.hashauth.apisecret = "#{site.proc.custom_env.API_SECRET}";
        Nightscout.client.hashauth.apisecrethash = "#{site.apisecrethash}";
        Nightscout.client.hashauth.verifyAuthentication(function  (authed) {
          console.log('AUTHED', authed);
          if (authed) {
            var img = $('<IMG />');
            img.attr('src', '/api/v1/status.png');
            $('.spinner').empty( ).append(img);
            $('#loadingMessageText').text('Connected');
            window.localStorage.apisecrethash = Nightscout.client.hashauth.apisecrethash;
          }
        });
      });
