
extends ../../layouts/default

block body
  div.row
    div.col-sm-6
      h3 Signup
    div


      #servicebot-subscription-portal
      script.
          window.servicebotSettings = !{JSON.stringify(servicebotSettings)};
          window.servicebotSettings.handleResponse = (async function({event, response}){
                  console.log(this, event, response);
                  if(event === "create_subscription" || event === "resubscribe"){
                      console.log("Activating account!", response);
                      let activationResponse = await fetch("/new-account/activate", {
                          method: "POST",
                          credentials: "include",
                          headers: {
                              'Content-Type': 'application/json',
                              // 'Content-Type': 'application/x-www-form-urlencoded',
                          },
                          body: JSON.stringify({
                              subscription_id: response.id
                          })
                      }).then(response => response.json());
                      console.log("response from server - ", activationResponse);
                      if (activationResponse.name) {
                        window.location = '/account/sites/' + activationResponse.name;
                      }
                  }
              });
          (function () {
              var s = document.createElement('script');
              s.src = 'https://js.servicebot.io/embeds/servicebot-billing-settings-embed.js';
              s.async = true;
              s.type = 'text/javascript';
              var x = document.getElementsByTagName('script')[0];
              x.parentNode.insertBefore(s, x);
          })();
